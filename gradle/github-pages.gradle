apply plugin: 'org.ajoberstar.git-publish'

def siteDir = "$buildDir/doc"
def apiDocDir = "$buildDir/docs/javadoc"
def groovyDocDir = "$buildDir/docs/groovydoc"

gitPublish {
    repoUri = 'git@github.com:OmniLayer/OmniJ.git'

    branch = 'gh-pages'

    // what to publish, this is a standard CopySpec
    contents {
        from("$siteDir")
        from("$apiDocDir") {
            into 'apidoc'
        }
        from("$groovyDocDir") {
            into 'groovydoc'
        }
    }

    // what to keep in the existing branch (include=keep)
//    preserve {
//        include '1.0.0/**'
//        exclude '1.0.0/temp.txt'
//    }

    commitMessage = 'Publishing via gradle' // defaults to 'Generated by gradle-git-publish'
}

gitPublishCopy.dependsOn javadocAll, groovydocAll, asciidoctor

tasks.register('publishSite') { dependsOn gitPublishPush }
